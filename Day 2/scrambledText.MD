## 为什么会出现乱码问题

在网络通信中，服务器与客户端（如浏览器）之间通过 HTTP 传输文本数据时，可能会因为字符编码问题导致显示乱码。这通常是因为服务器端生成的文本数据与客户端使用的字符编码不一致。

### 什么是字符编码？

字符编码是用来将字符转换为计算机可以理解的二进制数据的方式。常见的编码方式包括：

- **UTF-8**：一种兼容 ASCII 的编码，可以表示多种语言的字符，通常是网页中常用的编码格式。
- **ISO-8859-1** 或 **Latin-1**：较早期的西欧语言编码标准，无法表示非拉丁字符，如中文。

在处理网络传输时，服务器和浏览器默认使用的字符编码可能不同，如果服务器没有明确指定编码方式，浏览器会使用它的默认编码来解析数据，从而可能导致乱码。

### 出现乱码的原因

在你的代码中，服务器没有指定文本内容的字符编码。大多数现代浏览器会尝试自动检测编码，但如果没有明确指定，浏览器可能会错误地使用不同的编码（例如 ISO-8859-1），导致像中文等非 ASCII 字符在页面中显示为乱码。

在你遇到的情况中，`"Hello, World!"` 正确显示，而中文部分 `"今天的日期是"` 和日期中的非 ASCII 字符被错误解码，因而显示为乱码，例如 `浠婂ぉ鐨勬棩鏈熸槸`。

### 浏览器如何处理编码

浏览器通常会根据 HTTP 响应头中的 `Content-Type` 字段来决定如何处理服务器返回的数据。这个字段不仅指定数据的类型（如 `text/plain` 或 `text/html`），还可以指定字符编码方式（如 `charset=UTF-8`）。

如果服务器没有在响应头中明确指定编码，浏览器将根据默认的编码设置或网页中的 `<meta>` 标签来猜测应该使用什么编码。若浏览器猜测错误，就会导致字符显示不正确。

## 如何解决乱码问题

### 1. 设置正确的字符编码

最常见的解决方案是在服务器端明确指定响应内容的字符编码为 `UTF-8`，这样客户端（如浏览器）就能够正确解析文本数据。可以通过在 `writeHead` 中添加 `charset=utf-8` 来指定编码：

```js
res.writeHead(200, {'Content-Type': 'text/plain; charset=utf-8'});
```

这行代码告诉浏览器服务器返回的是 `text/plain` 类型的内容，编码为 `UTF-8`，确保所有非 ASCII 字符（如中文）能够正确显示。

### 2. 确保文件编码为 UTF-8

除了在服务器响应中指定编码，确保源代码文件本身是以 `UTF-8` 编码保存也很重要。通常，现代的文本编辑器都会默认使用 `UTF-8` 编码，但如果使用的是其他编码格式（如 GBK），可能在客户端解析时也会出现问题。

### 3. 检查浏览器的默认编码设置

虽然大部分现代浏览器默认使用 UTF-8 编码，但在某些情况下，用户可能会更改默认的编码设置。可以通过检查浏览器的编码设置来确保它与服务器的响应编码一致。